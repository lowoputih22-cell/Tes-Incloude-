<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  display:flex;
  height:100vh;
}

/* sidebar */
#sidebar{
  width:260px;
  background:#0f172a;
  color:white;
  padding:15px;
  overflow:auto;
}

#sidebar h2{
  text-align:center;
}

.menu{
  padding:10px;
  margin:6px 0;
  background:#1e293b;
  cursor:pointer;
  border-radius:6px;
}

.menu:hover{
  background:#334155;
}

button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  background:#22c55e;
  color:white;
  border-radius:6px;
  cursor:pointer;
}

button:hover{
  background:#16a34a;
}

#content{
  flex:1;
  padding:20px;
  overflow:auto;
}

/* popup */
#popup{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
}

#popupBox{
  background:white;
  padding:20px;
  width:330px;
  border-radius:10px;
}
</style>
</head>

<body>

<div id="sidebar">
  <h2>MENU</h2>
  <div id="menuList"></div>
  <button onclick="bukaPopup()">+ Tambah Menu</button>
</div>

<div id="content">
  <h2>Dashboard siap</h2>
  Pilih menu di kiri.
</div>

<!-- POPUP -->
<div id="popup">
  <div id="popupBox">
    <h3>Tambah Menu</h3>

    Nama Menu:
    <input type="text" id="namaMenu" style="width:100%;padding:8px">

    <br><br>
    Sumber Menu:
    <select id="sumber" onchange="gantiSumber()" style="width:100%;padding:8px">
      <option value="github">Folder Menu Github</option>
      <option value="link">Link Manual</option>
    </select>

    <br><br>
    <div id="pilihGithub">
      Pilih File:
      <select id="fileSelect" style="width:100%;padding:8px"></select>
    </div>

    <div id="pilihLink" style="display:none">
      Masukkan Link:
      <input type="text" id="linkManual" placeholder="https://..." style="width:100%;padding:8px">
    </div>

    <br>
    <button onclick="tambahMenu()">Tambah Menu</button>
    <button onclick="tutupPopup()" style="background:red;margin-top:6px">Batal</button>
  </div>
</div>

<script>
// ================= CONFIG =================
const username = "lowoputih22-cell";
const repo = "Tes-Incloude-";
const folder = "Menu";
// ==========================================

const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${folder}`;

// load menu dari localStorage
function loadMenu(){
  let data = JSON.parse(localStorage.getItem("menus")||"[]");
  let html="";

  data.forEach(item=>{
    html += `<div class="menu" onclick="loadPage('${item.url}')">${item.nama}</div>`;
  });

  document.getElementById("menuList").innerHTML = html;
}
loadMenu();

// buka popup
function bukaPopup(){
  document.getElementById("popup").style.display="flex";
  loadFileList();
}

function tutupPopup(){
  document.getElementById("popup").style.display="none";
}

// ganti sumber
function gantiSumber(){
  let s = document.getElementById("sumber").value;

  if(s==="github"){
    document.getElementById("pilihGithub").style.display="block";
    document.getElementById("pilihLink").style.display="none";
  }else{
    document.getElementById("pilihGithub").style.display="none";
    document.getElementById("pilihLink").style.display="block";
  }
}

// ambil list file github
function loadFileList(){
  fetch(apiUrl)
  .then(res=>res.json())
  .then(files=>{
    let opt="";
    files.forEach(file=>{
      if(file.name.endsWith(".html")){
        opt += `<option value="${file.download_url}">${file.name}</option>`;
      }
    });
    document.getElementById("fileSelect").innerHTML = opt;
  });
}

// tambah menu
function tambahMenu(){
  let nama = document.getElementById("namaMenu").value;
  let sumber = document.getElementById("sumber").value;
  let url="";

  if(nama===""){
    alert("Isi nama menu dulu");
    return;
  }

  if(sumber==="github"){
    url = document.getElementById("fileSelect").value;
  }else{
    url = document.getElementById("linkManual").value;
    if(url===""){
      alert("Isi link dulu");
      return;
    }
  }

  let data = JSON.parse(localStorage.getItem("menus")||"[]");
  data.push({nama:nama,url:url});
  localStorage.setItem("menus",JSON.stringify(data));

  tutupPopup();
  loadMenu();
}

// load halaman
function loadPage(url){
  fetch(url)
  .then(res=>res.text())
  .then(html=>{
    document.getElementById("content").innerHTML = html;
  })
  .catch(()=>{
    // jika bukan html (misal website luar)
    document.getElementById("content").innerHTML =
    `<iframe src="${url}" width="100%" height="600px" style="border:none"></iframe>`;
  });
}
</script>

</body>
</html>
